<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convenio com Sebrae e cenário financeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Stone, Gray, Sky Blue) -->
    <!-- Application Structure Plan: A tab-based single-page dashboard. Sections: Visão Geral (key metrics), Plano de Trabalho (budget changes chart), Análise Financeira (expense & cash flow charts), and Conclusões. This structure provides a high-level overview first, then allows users to explore specific areas, which is more intuitive and efficient than a linear presentation. -->
    <!-- Visualization & Content Choices: 1. Total Budget: Bar chart (Goal: Compare old/new, Interaction: Hover, Justification: Clear visual of reduction, Lib: Chart.js). 2. Monthly Expenses: Detailed HTML table (Goal: Compare with/without agreement, Justification: Provides granular detail requested by user, Lib: HTML/Tailwind). 3. Cash Flow: Combo Bar/Line chart (Goal: Show trend, Interaction: Hover with custom tooltips for details, Justification: Best for comparing different data types over time, Lib: Chart.js). 4. Key Metrics: Styled cards (Goal: Inform, Justification: Quick-glance info, Lib: HTML/Tailwind). -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 450px;
            max-height: 60vh;
        }
        .nav-btn {
            transition: all 0.3s ease;
        }
        .nav-btn.active {
            background-color: #0284c7; /* sky-600 */
            color: white;
            border-color: #0284c7; /* sky-600 */
        }
        .nav-btn:not(.active):hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            text-align: center;
        }
        .kpi-title {
            color: #475569; /* slate-600 */
            font-size: 1rem;
            font-weight: 500;
        }
        .kpi-value {
            color: #0f172a; /* slate-900 */
            font-size: 2.25rem;
            font-weight: 700;
            margin-top: 0.5rem;
        }
        .kpi-value.negative {
            color: #dc2626; /* red-600 */
        }
        .kpi-value.positive {
            color: #16a34a; /* green-600 */
        }
        table thead th {
            background-color: #f1f5f9; /* slate-100 */
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Cenário Financeiro com Convênio Sebrae</h1>
            <p class="text-slate-600 mt-2">Análise do convênio com o Sebrae e projeções para 2025</p>
        </header>

        <nav class="flex justify-center border-b border-slate-200 mb-8">
            <div class="flex flex-wrap justify-center gap-2 md:gap-4">
                <button id="nav-overview" class="nav-btn active text-sm md:text-base font-medium py-2 px-4 rounded-t-lg border-b-2 border-transparent">Visão Geral</button>
                <button id="nav-plan" class="nav-btn text-sm md:text-base font-medium py-2 px-4 rounded-t-lg border-b-2 border-transparent">Plano de Trabalho</button>
                <button id="nav-analysis" class="nav-btn text-sm md:text-base font-medium py-2 px-4 rounded-t-lg border-b-2 border-transparent">Análise Financeira</button>
                <button id="nav-conclusion" class="nav-btn text-sm md:text-base font-medium py-2 px-4 rounded-t-lg border-b-2 border-transparent">Equipe</button>
            </div>
        </nav>

        <main>
            <!-- Visão Geral Section -->
            <section id="content-overview" class="content-section active">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-semibold text-slate-800">Visão Geral</h2>
                    <p class="text-slate-500 mt-1">Os principais números que resumem o cenário financeiro.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="kpi-card">
                        <h3 class="kpi-title">Redução Total do Convênio</h3>
                        <p id="kpi-reduction" class="kpi-value negative"></p>
                    </div>
                    <div class="kpi-card">
                        <h3 class="kpi-title">Novo Valor Total do Convênio</h3>
                        <p id="kpi-new-total" class="kpi-value"></p>
                    </div>
                    <div class="kpi-card">
                        <h3 class="kpi-title">Redução Custo Mensal do Fórum</h3>
                        <p id="kpi-monthly-reduction" class="kpi-value positive"></p>
                    </div>
                </div>
            </section>

             <!-- Plano de Trabalho Section -->
            <section id="content-plan" class="content-section">
                 <div class="text-center mb-8">
                    <h2 class="text-2xl font-semibold text-slate-800">Alterações no Plano de Trabalho</h2>
                    <p class="text-slate-500 mt-1">Mudanças orçamentárias e detalhamento das metas afetadas.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-semibold text-center mb-4">Comparativo do Orçamento Total</h3>
                    <div class="chart-container" style="height:300px;">
                        <canvas id="budgetChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-center">Reestruturação das Metas</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-lg font-semibold mb-2">Fusão e Redução de Metas</h4>
                                <div class="p-4 bg-slate-100 rounded-lg">
                                    <p class="text-slate-700">A <strong class="text-slate-900">Meta 8</strong> (Eventos estratégicos, R$ 297.600) foi fundida com a <strong class="text-slate-900">Meta 11</strong> (Divulgação de produtos, R$ 225.000), resultando na nova <strong class="text-sky-600">Meta 10</strong> (R$ 322.760).</p>
                                    <li class="p-4 rounded-lg">
                                        <strong class="text-slate-900">Nova Meta 10:</strong> A despesa "Serviços profissionais - Aluguéis e encargos" foi reduzida de 18 meses (valor unitário R$ 8.500) para <strong>8 meses</strong>.
                                    </li>
                                    <p class="mt-2 font-semibold text-red-600">Redução na fusão: - R$ 199.840,00</p>
                                </div>
                                <h4 class="text-lg font-semibold mt-6 mb-2">Redução de Despesas Específicas</h4>
                                <div class="p-4 bg-slate-100 rounded-lg">
                                    <li class="bg-slate-100 rounded-lg">
                                        <strong class="text-slate-900">Meta 7:</strong> A despesa "Divulgação, anúncio, publicidade e propaganda" foi reduzida de 18 meses (valor unitário R$ 25.000) para <strong>8 meses</strong>.
                                        <p class="mt-2 font-semibold text-red-600">Redução:- R$ 249.280,00</p>
                                    </li>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold mb-2">Valores Redistribuídos</h4>
                                <div class="p-4 bg-slate-100 rounded-lg">
                                    <ul class="space-y-2 text-sm text-slate-700">
                                        <li><strong>Meta 1:</strong> + R$ 2.450,00</li>
                                        <li><strong>Meta 2:</strong> + R$ 300,00</li>
                                        <li><strong>Meta 4:</strong> + R$ 9.800,00</li>
                                        <li><strong>Meta 5:</strong> + R$ 1.350,00</li>
                                        <li><strong>Meta 6:</strong> + R$ 9.000,00</li>
                                        <li><strong>Meta 8:</strong> + R$ 900,00</li>
                                        <li><strong>Meta 9:</strong> + R$ 45.900,00</li>
                                        <li class="font-bold pt-2 border-t mt-2"><strong>Total Redistribuído:</strong> R$ 69.700,00</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
            </section>

            <!-- Análise Financeira Section -->
            <section id="content-analysis" class="content-section">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-semibold text-slate-800">Análise Financeira</h2>
                    <p class="text-slate-500 mt-1">Custos mensais com e sem convênios e projeções de saldo</p>
                </div>
                <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-semibold text-center mb-4">Despesas Mensais do Fórum</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="text-xs text-slate-700 uppercase">
                                <tr>
                                    <th scope="col" class="px-4 py-3">Descrição da Despesa</th>
                                    <th scope="col" class="px-4 py-3 text-right">Custo Com Convênios</th>
                                    <th scope="col" class="px-4 py-3 text-right">Custo Sem Convênios</th>
                                </tr>
                            </thead>
                            <tbody id="expense-table-body">
                                <!-- Rows will be injected by JavaScript -->
                            </tbody>
                            <tfoot class="font-semibold text-slate-800">
                                <tr class="border-t-2">
                                    <td class="px-4 py-3">Total Geral Mensal</td>
                                    <td id="total-with-agreement" class="px-4 py-3 text-right"></td>
                                    <td id="total-without-agreement" class="px-4 py-3 text-right"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="mt-4 p-4 bg-sky-100 border-l-4 border-sky-500 rounded-r-lg">
                        <p class="text-lg font-semibold text-sky-800">
                            Redução Mensal de Custo: <span id="monthly-savings" class="font-bold"></span>
                        </p>
                        <p class="text-sm text-sky-700">O convênio resulta em uma economia significativa, reduzindo o custo operacional do Fórum.</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-center mb-4">Projeção de Fluxo de Caixa com Saldo Acumulado</h3>
                    <div class="text-center mb-4">
                        <span class="text-slate-600">Saldo atual (21 de agosto): R$ 87.584,15</span>
                        <!--<span id="initial-balance" class="font-bold text-lg text-slate-800"></span>-->
                    </div>
                    <div class="chart-container">
                        <canvas id="cashflowChart"></canvas>
                    </div>
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                        <div class="p-4 bg-red-50 rounded-lg">
                            <h4 class="font-semibold text-red-800">Grande Despesa (Agosto)</h4>
                            <p class="text-lg font-bold text-red-600">- R$ 25.000,00</p>
                            <p class="text-sm text-red-700">Treinamento para o Fórum</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg">
                            <h4 class="font-semibold text-red-800">Grande Despesa (Agosto)</h4>
                            <p class="text-lg font-bold text-red-600">- R$ 45.000,00</p>
                            <p class="text-sm text-red-700">Pagamento FUNDAPE</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg">
                            <h4 class="font-semibold text-red-800">Grande Despesa (Novembro)</h4>
                            <p class="text-lg font-bold text-red-600">- R$ 50.000,00</p>
                            <p class="text-sm text-red-700">Aporte ao Convênio</p>
                        </div>
                        <div class="p-4 bg-green-50 rounded-lg">
                            <h4 class="font-semibold text-green-800">Saldo Final Previsto (Dez)</h4>
                            <p id="final-balance" class="text-lg font-bold text-green-600"></p>
                            <p class="text-sm text-green-700">Acumulado ao final do ano</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Conclusões Section -->
            <section id="content-conclusion" class="content-section">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-semibold text-slate-800">Custo da Equipe</h2>
                    <p class="text-slate-500 mt-1">Custo mensal e anual</p>
                </div>
                <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-200">
                                <th class="p-3 font-semibold text-sm text-slate-800 border border-slate-300">NOME</th>
                                <th class="p-3 font-semibold text-sm text-slate-800 border border-slate-300">MÊS</th>
                                <th class="p-3 font-semibold text-sm text-slate-800 border border-slate-300">TOTAL ANO</th>
                                <th class="p-3 font-semibold text-sm text-slate-800 border border-slate-300">TIPO</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ANNA FÁBIA FITTIPALDY DE OLIVEIRA</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 1.350,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 16.200,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ESTAGIÁRIO(A)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">LAIANNY SENA DA SILVA</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 1.350,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 16.200,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ESTAGIÁRIO(A)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ANDRÉ FERREIRA SANTANA</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 2.115,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 25.380,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ME (SEBRAE)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ANA PAULA PEREIRA DA SILVA</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 3.600,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 43.200,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">MEI (SEBRAE)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">EROS CÁSSIUS RIBEIRO DE MELO</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 1.680,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 20.160,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">MEI (SEBRAE)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ALINE DO NASCIMENTO LIMA</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 3.000,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 36.000,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">MEI (SEBRAE)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">STEFANI GABRIELE DE ALMEIDA CAR</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 5.000,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 60.000,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">MEI (FÓRUM)</td>
                            </tr1>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">JULIANA MONTEIRO DA CRUZ VILA N</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 2.311,11</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 27.733,33</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">REGISTRADO</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">JULIANA MONTEIRO DA CRUZ VILA N</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 4.939,93</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 59.279,16</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">MEI (SEPLAN)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">VELOSO LTDA</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 2.000,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 24.000,00</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ME (FÓRUM)</td>
                            </tr>
                            <tr>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">VELOSO LTDA</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 16.162,47</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">R$ 193.949,64</td>
                                <td class="p-3 text-sm text-slate-700 border border-slate-300">ME (SEPLAN)</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="bg-slate-100 font-bold">
                                <td class="p-3 text-sm text-slate-800 border border-slate-300">Total</td>
                                <td class="p-3 text-sm text-slate-800 border border-slate-300">R$ 43.508,51</td>
                                <td class="p-3 text-sm text-slate-800 border border-slate-300">R$ 522.102,13</td>
                                <td class="p-3 text-sm text-slate-800 border border-slate-300"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script>
        const formatCurrency = (value) => {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        };

        const data = {
            initialTotal: 2669600,
            newTotal: 2290180,
            totalReduction: -379420,
            monthlySavings: 35979.30,
            detailedExpenses: [
                { label: 'Equipe Fórum', withAgreement: 1400, withoutAgreement: 43508.51 },
                { label: 'Consultor DEL - Contrato e Diária', withAgreement: 29800, withoutAgreement: 29800 },
                { label: 'Passagem Estácio DEL Acre', withAgreement: 3000, withoutAgreement: 3000 },
                { label: 'Passagem Estácio DEL Amapá', withAgreement: 2500, withoutAgreement: 2500 },
                { label: 'Contador', withAgreement: 1300, withoutAgreement: 1300 },
                { label: 'ISS', withAgreement: 800, withoutAgreement: 800 },
                { label: 'Limpeza, Energia, Telefone e Internet', withAgreement: 1864, withoutAgreement: 1864 },
                { label: 'Locação Sala', withAgreement: 2650, withoutAgreement: 2650 },
                { label: 'Fundo Fixo', withAgreement: 759, withoutAgreement: 759 },
                { label: 'Taxa Bancária', withAgreement: 150, withoutAgreement: 150 },
                { label: 'Material de Expediente e Outros', withAgreement: 600, withoutAgreement: 600 },
            ],
            cashflow: {
                initialBalance: 31353,
                months: [
                    {
                        month: 'Agosto',
                        revenues: { total: 142480, details: [
                            { source: 'DEL Turismo - Epitaciolândia', value: 8400 },
                            { source: 'DEL Turismo - Rio Branco', value: 17000 },
                            { source: 'DEL Turismo - Amapá', value: 37500 },
                            { source: 'PAGAMENTO Consultoria Fórum ExpoJuruá 2025', value: 70000 },
                            { source: 'A receber de Julho (Xapuri)', value: 10080 }
                        ]},                        expenses: { total: 145645.45, details: [
                            { source: 'Fórum', value: 100645.45 },
                            { source: 'FUNDAPE', value: 45000 }
                        ]}
                    },
                    {
                        month: 'Setembro',
                        revenues: { total: 62900, details: [
                            { source: 'DEL Turismo - Epitaciolândia', value: 8400 },
                            { source: 'DEL Turismo - Rio Branco', value: 17000 },
                            { source: 'DEL Turismo - Amapá', value: 37500 }
                        ]},
                        expenses: { total: 44823, details: [
                            { source: 'Fórum', value: 44823 }
                        ]}
                    },
                    {
                        month: 'Outubro',
                        revenues: { total: 62900, details: [
                            { source: 'DEL Turismo - Epitaciolândia', value: 8400 },
                            { source: 'DEL Turismo - Rio Branco', value: 17000 },
                            { source: 'DEL Turismo - Amapá', value: 37500 }
                        ]},
                        expenses: { total: 44823, details: [
                            { source: 'Fórum', value: 44823 }
                        ]}
                    },
                    {
                        month: 'Novembro',
                        revenues: { total: 125900, details: [
                            { source: 'DEL Turismo - Epitaciolândia', value: 8400 },
                            { source: 'DEL Turismo - Rio Branco', value: 17000 },
                            { source: 'DEL Turismo - Amapá', value: 37500 },
                            { source: 'DEVOLUÇÃO IEL', value: 63000 }
                        ]},
                        expenses: { total: 94823, details: [
                            { source: 'Fórum', value: 44823 },
                            { source: 'Aporte Convênio', value: 50000 }
                        ]}
                    },
                    {
                        month: 'Dezembro',
                        revenues: { total: 62900, details: [
                            { source: 'DEL Turismo - Epitaciolândia', value: 8400 },
                            { source: 'DEL Turismo - Rio Branco', value: 17000 },
                            { source: 'DEL Turismo - Amapá', value: 37500 }
                        ]},
                        expenses: { total: 44823, details: [
                            { source: 'Fórum', value: 44823 }
                        ]}
                    }
                ]
            }
        };
        
        // Calculate cumulative balance
        let cumulativeBalance = data.cashflow.initialBalance;
        const cumulativeBalances = data.cashflow.months.map(m => {
            const monthlyBalance = m.revenues.total - m.expenses.total;
            cumulativeBalance += monthlyBalance;
            return cumulativeBalance;
        });

        const totalWithAgreement = data.detailedExpenses.reduce((sum, item) => sum + item.withAgreement, 0);
        const totalWithoutAgreement = data.detailedExpenses.reduce((sum, item) => sum + item.withoutAgreement, 0);
        const monthlySavings = totalWithoutAgreement - totalWithAgreement;

        document.addEventListener('DOMContentLoaded', () => {
            
            document.getElementById('total-with-agreement').textContent = formatCurrency(totalWithAgreement);
            document.getElementById('total-without-agreement').textContent = formatCurrency(totalWithoutAgreement);

            document.getElementById('kpi-reduction').textContent = formatCurrency(data.totalReduction);
            document.getElementById('kpi-new-total').textContent = formatCurrency(data.newTotal);
            document.getElementById('kpi-monthly-reduction').textContent = formatCurrency(data.monthlySavings);
            //document.getElementById('initial-balance').textContent = formatCurrency(data.cashflow.initialBalance);
            document.getElementById('final-balance').textContent = formatCurrency(cumulativeBalances[cumulativeBalances.length - 1]);
            document.getElementById('monthly-savings').textContent = formatCurrency(monthlySavings);

            const navButtons = document.querySelectorAll('.nav-btn');
            const contentSections = document.querySelectorAll('.content-section');

            const expenseTableBody = document.getElementById('expense-table-body');
            data.detailedExpenses.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b';
                row.innerHTML = `
                    <td class="px-4 py-2">${item.label}</td>
                    <td class="px-4 py-2 text-right">${formatCurrency(item.withAgreement)}</td>
                    <td class="px-4 py-2 text-right text-slate-500">${formatCurrency(item.withoutAgreement)}</td>
                `;
                expenseTableBody.appendChild(row);
            });

            const switchTab = (tabId) => {
                navButtons.forEach(btn => btn.classList.remove('active'));
                contentSections.forEach(section => section.classList.remove('active'));
                document.getElementById(`nav-${tabId}`).classList.add('active');
                document.getElementById(`content-${tabId}`).classList.add('active');
            };

            navButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const tabId = e.target.id.replace('nav-', '');
                    switchTab(tabId);
                });
            });
            
            const budgetCtx = document.getElementById('budgetChart').getContext('2d');
            new Chart(budgetCtx, {
                type: 'bar',
                data: {
                    labels: ['Orçamento Total'],
                    datasets: [
                        {
                            label: 'Valor Inicial',
                            data: [data.initialTotal],
                            backgroundColor: '#94a3b8', // slate-400
                        },
                        {
                            label: 'Valor Atual',
                            data: [data.newTotal],
                            backgroundColor: '#38bdf8', // sky-400
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { ticks: { callback: value => formatCurrency(value) } } },
                    plugins: { legend: { position: 'top' } }
                }
            });


            const cashflowCtx = document.getElementById('cashflowChart').getContext('2d');
            new Chart(cashflowCtx, {
                type: 'bar',
                data: {
                    labels: data.cashflow.months.map(m => m.month),
                    datasets: [
                        {
                            label: 'Receitas',
                            data: data.cashflow.months.map(m => m.revenues.total),
                            backgroundColor: '#38bdf8', // sky-400
                            order: 2
                        },
                        {
                            label: 'Despesas',
                            data: data.cashflow.months.map(m => m.expenses.total),
                            backgroundColor: '#f87171', // red-400
                            order: 2
                        },
                         {
                            label: 'Saldo Acumulado',
                            data: cumulativeBalances,
                            type: 'line',
                            borderColor: '#22c55e', // green-500
                            backgroundColor: '#22c55e',
                            tension: 0.1,
                            borderWidth: 3,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: value => formatCurrency(value)
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            enabled: true,
                            callbacks: {
                                footer: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    const monthData = data.cashflow.months[index];
                                    
                                    let revenueDetails = monthData.revenues.details.map(d => `  + ${d.source}: ${formatCurrency(d.value)}`).join('\\n');
                                    let expenseDetails = monthData.expenses.details.map(d => `  - ${d.source}: ${formatCurrency(d.value)}`).join('\\n');

                                    const prevBalance = index > 0 ? cumulativeBalances[index - 1] : data.cashflow.initialBalance;
                                    const monthlyBalance = monthData.revenues.total - monthData.expenses.total;

                                    let details = ['\\n--- Detalhamento ---'];
                                    details.push('Receitas:');
                                    details.push(revenueDetails);
                                    details.push('\\nDespesas:');
                                    details.push(expenseDetails);
                                    details.push('\\n--- Saldo do Mês ---');
                                    details.push(`Saldo Anterior: ${formatCurrency(prevBalance)}`);
                                    details.push(`Resultado do Mês: ${formatCurrency(monthlyBalance)}`);
                                    
                                    return details.join('\\n').split('\\n');
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
